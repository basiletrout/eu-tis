rule SuspiciousPowerShell
{
    meta:
        description = "Detects suspicious PowerShell commands"
        author = "Security Team"
        date = "2024-01-01"

    strings:
        $s1 = "Invoke-Expression" ascii wide
        $s2 = "DownloadString" ascii wide
        $s3 = "IEX" ascii wide
        $s4 = "powershell.exe" ascii wide

    condition:
        any of ($s*)
}

rule MaliciousExecutable
{
    meta:
        description = "Generic malicious executable detection"
        author = "Security Team"

    strings:
        $hex1 = { 4D 5A 90 00 }  // PE header
        $str1 = "CreateRemoteThread" ascii
        $str2 = "VirtualAllocEx" ascii

    condition:
        $hex1 at 0 and any of ($str*)
}