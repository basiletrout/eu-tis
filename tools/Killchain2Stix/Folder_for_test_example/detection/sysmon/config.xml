<?xml version="1.0" encoding="UTF-8"?>
<Sysmon schemaversion="4.82">
  <EventFiltering>
    <!-- Event ID 1: Process creation -->
    <RuleGroup name="" groupRelation="or">
      <ProcessCreate onmatch="include">
        <Image condition="contains">powershell.exe</Image>
        <Image condition="contains">cmd.exe</Image>
        <CommandLine condition="contains">Invoke-Expression</CommandLine>
        <CommandLine condition="contains">DownloadString</CommandLine>
      </ProcessCreate>
    </RuleGroup>

    <!-- Event ID 3: Network connection -->
    <RuleGroup name="" groupRelation="or">
      <NetworkConnect onmatch="include">
        <DestinationPort condition="is">443</DestinationPort>
        <DestinationPort condition="is">80</DestinationPort>
      </NetworkConnect>
    </RuleGroup>
  </EventFiltering>
</Sysmon>